{"ast":null,"code":"import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import React,{useState,useEffect,useMemo}from'react';import AsyncStorage from'@react-native-async-storage/async-storage';import{NavigationContainer}from'@react-navigation/native';import{createStackNavigator}from'@react-navigation/stack';import{createMaterialTopTabNavigator}from'@react-navigation/material-top-tabs';import Icon from\"@expo/vector-icons/FontAwesome\";import{USER}from\"./src/constants/variables\";import HomeScreen from\"./src/screens/HomeScreen\";import AssessmentScreen from\"./src/screens/AssessmentScreen\";import StaffQuestionnaireScreen from\"./src/screens/StaffQuestionnaireScreen\";import ManagerQuestionnaireScreen from\"./src/screens/ManagerQuestionnaireScreen\";import VideoWebViewScreen from\"./src/screens/VideoWebViewScreen\";import LoginScreen from\"./src/screens/LoginScreen\";import{AuthContext}from\"./src/components/context\";import RootStackScreen from\"./src/screens/RootStackScreen\";import{COLORS}from\"./src/constants/theme\";import UserListScreen from\"./src/screens/UserListScreen\";import*as serviceWorkerRegistration from\"./src/serviceWorkerRegistration\";var Stack=createStackNavigator();var Tab=createMaterialTopTabNavigator();var Questionnaire=function Questionnaire(_ref){var route=_ref.route;var userId=route.params.userId;var sheetID=route.params.sheetID;var year=route.params.year;var part=route.params.part;return React.createElement(Tab.Navigator,null,React.createElement(Tab.Screen,{name:\"AllStaff\",component:StaffQuestionnaireScreen,options:{title:'ทั่วไป'},initialParams:{userId:userId,sheetID:sheetID,year:year,part:part}}),React.createElement(Tab.Screen,{name:\"Manager\",component:ManagerQuestionnaireScreen,options:{title:'ผู้จัดการถาม'},initialParams:{userId:userId,sheetID:sheetID,year:year,part:part}}));};var App=function App(){var initialLoginState={isLoading:true,userName:null,userToken:null};var loginReducer=function loginReducer(prevState,action){switch(action.type){case'RETRIEVE_TOKEN':return _objectSpread(_objectSpread({},prevState),{},{userToken:action.token,isLoading:false});case'LOGIN':return _objectSpread(_objectSpread({},prevState),{},{userName:action.id,userToken:action.token,isLoading:false});case'LOGOUT':return _objectSpread(_objectSpread({},prevState),{},{userName:null,userToken:null,isLoading:false});}};var _React$useReducer=React.useReducer(loginReducer,initialLoginState),_React$useReducer2=_slicedToArray(_React$useReducer,2),loginState=_React$useReducer2[0],dispacth=_React$useReducer2[1];var authContext=useMemo(function(){return{signIn:function signIn(userName,position,department){var userToken;userToken=userName;USER.position=position;USER.department=department;USER.userid=userName;dispacth({type:'LOGIN',id:userName,token:userToken});},signOut:function signOut(){dispacth({type:'LOGOUT'});}};},[]);var logoutState=function logoutState(){return _regeneratorRuntime.async(function logoutState$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return _regeneratorRuntime.awrap(AsyncStorage.removeItem('user_login'));case 3:return _context.abrupt(\"return\",true);case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);console.log('error: ',_context.t0);case 9:case\"end\":return _context.stop();}}},null,null,[[0,6]],Promise);};return React.createElement(AuthContext.Provider,{value:authContext},React.createElement(NavigationContainer,null,loginState.userToken!=null?React.createElement(Stack.Navigator,{screenOptions:{headerShown:true,headerRight:function headerRight(){return React.createElement(Icon,{name:\"sign-out\",size:20,style:{marginHorizontal:16},onPress:function onPress(){logoutState();authContext.signOut();}});}},initialRouteName:\"Home\"},React.createElement(Stack.Screen,{name:\"Home\",component:HomeScreen,options:{title:'หน้าแรก'},initialParams:{userid:loginState.userToken}}),React.createElement(Stack.Screen,{name:\"Assessment\",component:AssessmentScreen,options:{title:'ปีประเมิน'}}),React.createElement(Stack.Screen,{name:\"UserList\",component:UserListScreen,options:{title:'รายชื่อ'}}),React.createElement(Stack.Screen,{name:\"Questionnaire\",component:Questionnaire,options:{title:'แบบประเมิน'}}),React.createElement(Stack.Screen,{name:\"VideoWebView\",component:VideoWebViewScreen,options:{title:'ดูวิดีโอ'}})):React.createElement(RootStackScreen,null)));};export default App;serviceWorkerRegistration.register();","map":{"version":3,"sources":["/Users/drift/Documents/ReactNative/cal-assessment/App.js"],"names":["React","useState","useEffect","useMemo","AsyncStorage","NavigationContainer","createStackNavigator","createMaterialTopTabNavigator","Icon","USER","HomeScreen","AssessmentScreen","StaffQuestionnaireScreen","ManagerQuestionnaireScreen","VideoWebViewScreen","LoginScreen","AuthContext","RootStackScreen","COLORS","UserListScreen","serviceWorkerRegistration","Stack","Tab","Questionnaire","route","userId","params","sheetID","year","part","title","App","initialLoginState","isLoading","userName","userToken","loginReducer","prevState","action","type","token","id","useReducer","loginState","dispacth","authContext","signIn","position","department","userid","signOut","logoutState","removeItem","console","log","headerShown","headerRight","marginHorizontal","register"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useMemo } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { NavigationContainer } from '@react-navigation/native';\nimport { createStackNavigator } from '@react-navigation/stack';\nimport { createMaterialTopTabNavigator } from '@react-navigation/material-top-tabs';\n\nimport Icon from 'react-native-vector-icons/FontAwesome';\nimport { USER } from './src/constants/variables'\n\nimport HomeScreen from './src/screens/HomeScreen'\nimport AssessmentScreen from './src/screens/AssessmentScreen';\nimport StaffQuestionnaireScreen from './src/screens/StaffQuestionnaireScreen';\nimport ManagerQuestionnaireScreen from './src/screens/ManagerQuestionnaireScreen';\nimport VideoWebViewScreen from './src/screens/VideoWebViewScreen';\nimport LoginScreen from './src/screens/LoginScreen';\n\nimport { AuthContext } from './src/components/context';\nimport RootStackScreen from './src/screens/RootStackScreen';\nimport { COLORS } from './src/constants/theme';\nimport UserListScreen from './src/screens/UserListScreen';\n\nimport * as serviceWorkerRegistration from \"./src/serviceWorkerRegistration\";\n\nconst Stack = createStackNavigator();\nconst Tab = createMaterialTopTabNavigator();\n\nconst Questionnaire = ({ route }) => {\n\n  const userId = route.params.userId;\n  const sheetID = route.params.sheetID;\n  const year = route.params.year;\n  const part = route.params.part;\n\n  // console.log(route);\n  return (\n    <Tab.Navigator>\n      <Tab.Screen\n        name=\"AllStaff\"\n        component={StaffQuestionnaireScreen}\n        options={{ title: 'ทั่วไป' }}\n        // listeners={({ navigation }) => ({ blur: () => navigation.setParams({ screen: undefined }) })}\n        initialParams={{ userId: userId, sheetID: sheetID, year: year, part: part }} />\n      <Tab.Screen\n        name=\"Manager\"\n        component={ManagerQuestionnaireScreen}\n        options={{ title: 'ผู้จัดการถาม' }}\n        // listeners={({ navigation }) => ({ blur: () => navigation.setParams({ screen: undefined }) })}\n        initialParams={{ userId: userId, sheetID: sheetID, year: year, part: part }} />\n    </Tab.Navigator>\n  );\n}\n\nconst App = () => {\n\n  // const [isLoading, setIsLoading] = useState(true);\n  // const [userToken, setUserToken] = useState(null);\n\n  const initialLoginState = {\n    isLoading: true,\n    userName: null,\n    userToken: null,\n  };\n\n  const loginReducer = (prevState, action) => {\n    switch (action.type) {\n      case 'RETRIEVE_TOKEN':\n        return {\n          ...prevState,\n          userToken: action.token,\n          isLoading: false\n        };\n      case 'LOGIN':\n        return {\n          ...prevState,\n          userName: action.id,\n          userToken: action.token,\n          isLoading: false\n        };\n      case 'LOGOUT':\n        return {\n          ...prevState,\n          userName: null,\n          userToken: null,\n          isLoading: false\n        };\n    }\n  };\n\n  const [loginState, dispacth] = React.useReducer(loginReducer, initialLoginState);\n\n  const authContext = useMemo(() => ({\n    signIn: (userName, position, department) => {\n      // setUserToken('asdf');\n      // setIsLoading(false);\n      let userToken;\n      // userName = null;\n      // if (userName === 'User' && password === 'Pass') {\n      userToken = userName;\n      USER.position = position;\n      USER.department = department;\n      USER.userid = userName;\n\n      // console.log(LOGIN.position);\n      // }\n      dispacth({ type: 'LOGIN', id: userName, token: userToken });\n    },\n    signOut: () => {\n      // setUserToken(null);\n      // setIsLoading(false);\n      dispacth({ type: 'LOGOUT' });\n    },\n  }), []);\n\n  const logoutState = async () => {\n    // console.log(queueSelect);\n    try {\n      await AsyncStorage.removeItem('user_login');\n      return true;\n\n    } catch (error) {\n      console.log('error: ', error);\n    }\n  };\n\n  return (\n    <AuthContext.Provider value={authContext}>\n      <NavigationContainer>\n        {/* {console.log(loginState.userToken)} */}\n        {loginState.userToken != null ? (\n\n          <Stack.Navigator\n            screenOptions={{\n              headerShown: true,\n              headerRight: () => <Icon name='sign-out'\n                // color= {COLORS.primary}\n                size={20}\n                style={{ marginHorizontal: 16 }}\n                onPress={() => {\n                  logoutState();\n                  authContext.signOut();\n\n                }}\n              />\n            }}\n            initialRouteName=\"Home\">\n\n            <Stack.Screen name=\"Home\" component={HomeScreen} options={{ title: 'หน้าแรก', }} initialParams={{ userid: loginState.userToken }} />\n            <Stack.Screen name=\"Assessment\" component={AssessmentScreen} options={{ title: 'ปีประเมิน' }} />\n            <Stack.Screen name=\"UserList\" component={UserListScreen} options={{ title: 'รายชื่อ' }} />\n            <Stack.Screen name=\"Questionnaire\" component={Questionnaire} options={{ title: 'แบบประเมิน' }} />\n            <Stack.Screen name=\"VideoWebView\" component={VideoWebViewScreen} options={{ title: 'ดูวิดีโอ' }} />\n          </Stack.Navigator>\n        )\n\n          :\n\n          <RootStackScreen />\n        }\n\n      </NavigationContainer>\n\n    </AuthContext.Provider>\n\n  );\n}\n\nexport default App;\n\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://cra.link/PWA\nserviceWorkerRegistration.register();"]},"metadata":{},"sourceType":"module"}